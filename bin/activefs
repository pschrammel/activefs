#!/usr/bin/env ruby

require 'pathname'
root=Pathname.new(File.expand_path(File.dirname(__FILE__)+'/..'))
$: << root.join('lib')
require('activefs')


def oh(hash_str)
  Activefs::Util::Objecthash.new(hash_str)
end

cmd=ARGV[0]
case cmd
  when "index_list"
    repo=Activefs::LocalRepo.open(ARGV[1])
    repo.index.each do |entry|
      p entry
    end
  when "heads" #
    repo=Activefs::LocalRepo.open(ARGV[1])
    repo.heads.each do |name, hash|
      puts "#{name} : #{hash}"
    end
  when "head" #name
    repo=Activefs::LocalRepo.open(ARGV[1])
    puts repo.head(ARGV[2])
  when "unpack" #hash
    repo=Activefs::LocalRepo.open(ARGV[1])
    entry=repo.index.at(oh(ARGV[2]))
    content=repo.get(oh(ARGV[2]))

    puts content
  when "unpack_p" #hash
    repo=Activefs::LocalRepo.open(ARGV[1])
    entry=repo.index.at(oh(ARGV[2]))

    p entry
    p repo.get(oh(ARGV[2]))

  when "ls" # path_name
    repo=Activefs::LocalRepo.open(ARGV[1])
    path=ARGV[2]
    repo.ls(path).each do |entry|
      puts entry.path
    end
end
 